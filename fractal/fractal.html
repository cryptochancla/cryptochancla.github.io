<html>
<head>
    <title>Indra's Net</title>
    <style>
        body{
            background-color: rgb(26, 26, 26);
            text-align:center;
            margin:0;
            padding:0;
        }
    </style>
</head>
<body>



    <canvas>
        Désolé, votre navigateur ne prend pas en charge &lt;canvas&gt;.
      </canvas>

</body>


<script>
var canvas = document.querySelector('canvas');
var ctx = canvas.getContext('2d');


largeur = window.innerWidth;
hauteur = window.innerWidth*9/16;
//largeur = 800;
//hauteur = 400;

ctx.canvas.width = largeur;
ctx.canvas.height = hauteur;

x_min = -2;
x_max = 2;

y_min = -1;
y_max = 1;

function render(zoom,x_souris,y_souris){
    ctx.clearRect(0, 0, largeur, hauteur);







    //calcul du centre
    centre_x = largeur/2;
    centre_y = hauteur/2;
    //quelle diff entre nouveau point et le centre ?
    diff_x = x_souris - centre_x;
    diff_y = y_souris - centre_y;
    //calcul du centre relatif
    centre_x_relatif = (x_max-x_min)/2;
    centre_y_relatif = (y_max-y_min)/2;
    //calcul diff relative ( largeur/2 <=> (x_max-x_min)/2 )
    diff_relative_x = diff_x*centre_x_relatif/centre_x;
    diff_relative_y = diff_y*centre_y_relatif/centre_y;
    //appliquer la diff relative
    x_min = x_min +diff_relative_x; 
    x_max = x_max +diff_relative_x; 
    y_min = y_min +diff_relative_y; 
    y_max = y_max +diff_relative_y; 


    //le zoom 
    x_min*=zoom;
    x_max*=zoom;
    y_min*=zoom;
    y_max*=zoom;
    console.log("x_min : "+x_min);
    console.log("x_max : "+x_max);
    console.log("y_min : "+y_min);
    console.log("y_max : "+y_max);

    x_incr_z = (x_max-x_min)/largeur;
    y_incr_z = (y_max-y_min)/hauteur;


    x_ecran = 0;
    x = x_min;
    while(x<x_max){
        x+=x_incr_z;
        x_ecran ++;

        y_ecran = 0;
        y = y_min;
        while(y<y_max){
            y += y_incr_z;
            y_ecran ++;

            

            n = 0;
            an = x;
            bn = y;
            anp1 = x;
            bnp1 = y;
            
            while(n<200 && !((anp1*anp1+bnp1*bnp1) > 4) ){

                an = anp1;
                bn = bnp1;

                anp1 = an*an - bn*bn + x;
                bnp1 = 2*an*bn + y;

                n ++;

            }

            m = anp1*anp1+bnp1*bnp1;
        
            if(n!=200){
                //ctx.fillStyle = 'rgb('+m*64+','+m*32+','+m*16+')';

                ctx.fillStyle = 'hsl('+ 360*m +',200%,50%)';

                ctx.fillRect(x_ecran, y_ecran, 1, 1);
            }
            else{
                //ctx.fillStyle = 'hsl('+ 2*Math.random() +',200%,50%)';
                
                //ctx.fillStyle = 'white';
                //ctx.fillRect(x_ecran, y_ecran, 1, 1);
            }

        }

    }


    //encadre debug
   // ctx.strokeStyle = "black";
    //ctx.strokeRect(x_souris-largeur*0.9/2, y_souris-hauteur*0.9/2, largeur*0.9, hauteur*0.9);



}

zoomConst = 1;

render(zoomConst,largeur/2,hauteur/2);

canvas.addEventListener("click",function(e){
    x_tmp = e.clientX-canvas.getBoundingClientRect().left;
    y_tmp = e.clientY-canvas.getBoundingClientRect().top;

    zoomConst=0.7;

    render(zoomConst,x_tmp,y_tmp);
});

</script>

</html>